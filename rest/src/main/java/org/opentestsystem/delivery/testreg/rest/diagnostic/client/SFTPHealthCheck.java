package org.opentestsystem.delivery.testreg.rest.diagnostic.client;

import org.springframework.integration.sftp.session.DefaultSftpSessionFactory;

import java.io.IOException;

public class SFTPHealthCheck {
    private final String host;
    private final DefaultSftpSessionFactory defaultSftpSessionFactory;

    public SFTPHealthCheck(final String host, final String user, final String password) {
        this(host, 22, user, password);
    }

    public SFTPHealthCheck(final String host, final int port, final String user, final String password) {
        this.host = host;

        defaultSftpSessionFactory = new DefaultSftpSessionFactory(false);
        defaultSftpSessionFactory.setPort(port);
        defaultSftpSessionFactory.setHost(host);
        defaultSftpSessionFactory.setUser(user);
        defaultSftpSessionFactory.setPassword(password);
        defaultSftpSessionFactory.setTimeout(5000);
    }

    public String getHost() {
        return host;
    }

    /**
     * Tests that a response is given from the SFTP server
     * @throws IOException
     */
    public boolean pathExists(final String path) throws IOException {
        try (AutoSFTPSession auto = new AutoSFTPSession(defaultSftpSessionFactory.getSession())) {
            return auto.exists(path);
        }
    }
}
