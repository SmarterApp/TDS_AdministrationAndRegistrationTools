package org.opentestsystem.delivery.testreg.rest.diagnostic;

import tds.dll.common.diagnostic.domain.Rating;
import tds.dll.common.diagnostic.domain.Status;
import static java.lang.String.format;

public class DiagnosticUtil {
    // returns a message for a dependency error
    static public String getDependencyErrorMessage(final String unit, final String host, final Throwable reason) {
        return format("Dependency error with %s. Check server %s - Reason: %s", unit, host, reason.getLocalizedMessage());
    }

    // sets warning status parameters
    static public void setStatusWarning(final Status status, final String message) {
        status.setRating(Rating.WARNING);
        status.setWarning(message);
        status.setError(null);
    }

    // sets error status parameters
    static public void setStatusError(final Status status, final String message) {
        status.setRating(Rating.FAILED);
        status.setError(message);
        status.setWarning(null);
    }

    // converts string to a rating
    static public Rating getRating(final String statusText) {
        for(Rating rating: Rating.values()) {
            if (rating.getStatusText().equals(statusText)) return rating;
        }

        throw new IllegalArgumentException(statusText + ": rating value does not exist");
    }

    // sets status parameters based on rating
    static public void setStatus(final Status status, final Rating rating, final String message) {
        status.setRating(rating);
        switch (rating) {
            case FAILED: status.setError(message); break;
            case WARNING: status.setWarning(message); break;
        }
    }

    static public String print(final Status status) {
        final String base = format("Unit: %s - Rating: %s", status.getUnit(), status.getRating().getStatusText());
        String message;
        switch (status.getRating()) {
            case FAILED: message = format("%s\nError: %s", base, status.getError()); break;
            case WARNING: message = format("%s\nWarning: %s", base, status.getWarning()); break;
            default: message = base;
        }

        return message;
    }
}
